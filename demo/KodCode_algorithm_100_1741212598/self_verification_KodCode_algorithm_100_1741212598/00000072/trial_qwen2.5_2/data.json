{
  "metadata": {
    "prompt_id": "00000072",
    "row_id": 72,
    "seed_ids": [
      956
    ],
    "mode": "algorithm"
  },
  "instruction": "### Scenario\nYou are developing a multimedia application where you need to compare the quality of two images to determine the effectiveness of a compression algorithm. Your task is to write a function to calculate the PSNR between two images and a main function to test the implementation.\n\n### Instructions\n1. Implement a function `calculate_psnr(image1: np.ndarray, image2: np.ndarray) -> float` that computes the PSNR between two images.\n2. The function should return the PSNR value in dB.\n3. Ensure the function handles the case where the mean squared error (MSE) is zero.\n4. The images are assumed to be 8-bit grayscale images and are represented as NumPy arrays.\n5. Include a main function `test_psnr()` to test your implementation using the provided images. The main function should:\n   - Compare two images and print the PSNR value.\n   - Compare another pair of images and print the PSNR value, ensuring it matches the expected value of 31.53 dB (from the Wikipedia example).\n\n### Constraints\n- The images are both grayscale and in the range of 0 to 255.\n\n### Example\n```python\nimport numpy as np\n\nimage1 = np.array([[128, 128, 128], [128, 128, 128]], dtype=np.uint8)\nimage2 = np.array([[128, 128, 128], [128, 128, 128]], dtype=np.uint8)\n\npsnr = calculate_psnr(image1, image2)\nprint(f\"PSNR value is {psnr} dB\")\n# Expected output: PSNR value is 100.0 dB\n```\n\n### Expected Output\n- The PSNR value should be printed in dB.\n- Ensure that the PSNR calculation matches the expected values for the provided images.\n\n### Performance Requirements\n- The function should be efficient and handle large images without significant performance degradation.\n\n### Hint\n- Utilize NumPy for efficient array operations to speed up the computation.",
  "solution_code": "import numpy as np\n\ndef calculate_psnr(image1: np.ndarray, image2: np.ndarray) -> float:\n    \"\"\"\n    Calculates the Peak Signal-to-Noise Ratio (PSNR) between two images.\n    \n    :param image1: First image (grayscale, uint8)\n    :param image2: Second image (grayscale, uint8)\n    :return: PSNR value in dB\n    \"\"\"\n    if image1.shape != image2.shape:\n        raise ValueError(\"Image shapes do not match\")\n    \n    height, width = image1.shape\n    mse = np.mean((image1 - image2) ** 2)\n    if mse == 0:\n        return float('inf')  # Indicates perfect match\n    \n    max_pixel_value = 255.0\n    psnr = 20 * np.log10(max_pixel_value / np.sqrt(mse))\n    return psnr",
  "test_code": "import numpy as np\nimport pytest\n\ndef test_psnr():\n    # Test case 1: Identical images\n    image1 = np.array([[128, 128, 128], [128, 128, 128]], dtype=np.uint8)\n    image2 = np.array([[128, 128, 128], [128, 128, 128]], dtype=np.uint8)\n    psnr = calculate_psnr(image1, image2)\n    assert psnr == 100.0\n\n    # Test case 2: Slightly different images\n    image1 = np.array([[128, 128, 128], [128, 128, 128]], dtype=np.uint8)\n    image2 = np.array([[129, 129, 129], [129, 129, 129]], dtype=np.uint8)\n    psnr = calculate_psnr(image1, image2)\n    assert np.isclose(psnr, 99.845, atol=0.01)\n\n    # Test case 3: Large difference\n    image1 = np.array([[0, 0, 0], [0, 0, 0]], dtype=np.uint8)\n    image2 = np.array([[255, 255, 255], [255, 255, 255]], dtype=np.uint8)\n    psnr = calculate_psnr(image1, image2)\n    assert np.isclose(psnr, 15.96, atol=0.01)\n\n    # Test case 4: Edge case with zero mse\n    image1 = np.array([[1, 1, 1], [1, 1, 1]], dtype=np.uint8)\n    image2 = np.array([[1, 1, 1], [1, 1, 1]], dtype=np.uint8)\n    psnr = calculate_psnr(image1, image2)\n    assert psnr == float('inf')\n\n    # Test case 5: Wikipedia example\n    image1 = np.array([[100, 100, 100], [100, 100, 100]], dtype=np.uint8)\n    image2 = np.array([[100, 100, 100], [100, 99, 99]], dtype=np.uint8)\n    psnr = calculate_psnr(image1, image2)\n    assert np.isclose(psnr, 31.53, atol=0.01)",
  "file_source": "KodCode_questions2sv_algorithm_100_1741212598_sanitized_prepared_results2.jsonl"
}